<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="zh-tw">
<head>
    <meta charset="utf-8">
<title>Huangzl&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



            
<link href="https://ikkkp.github.io/en/" rel="alternate" hreflang="en" />
            
    


    
    <meta name="description" content="Huli 的技術部落格，寫關於前端、JavaScript、資安以及各種技術議題。A tech blog about frotn-end and security">
    



    
<link rel="canonical" href="https://ikkkp.github.io/">
    





    <meta property="og:type" content="website">
<meta property="og:title" content="Huangzl&#39;s blog">
<meta property="og:url" content="https://ikkkp.github.io/index.html">
<meta property="og:site_name" content="Huangzl&#39;s blog">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Huangzl">
<meta name="twitter:card" content="summary_large_image">



<link rel="alternative" href="/atom.xml" title="Huangzl&#39;s blog" type="application/atom+xml">



<link rel="icon" href="/img/IK.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">


<link rel="stylesheet" href="/css/bulma.css?v=2.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />


<link rel="stylesheet" href="/css/style.css?v=4.css">





    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6DE5K2B5GE"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-6DE5K2B5GE');
</script>


    


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <script>
        if (localStorage.getItem('dark-mode')) {
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode')
            }
        } else {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode')
            }
        }
    </script>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Huangzl&#39;s blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">文章列表</a>
            
            <a class="navbar-item "
               href="/categories">分類</a>
            
            <a class="navbar-item "
               href="/recommend">推薦閱讀</a>
            
            <a class="navbar-item "
               href="/abouts">關於我</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            
            
            <a class="navbar-item" target="_blank" title="Twitter" href="https://twitter.com/hungzln3">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" target="_blank" title="RSS" href="https://ikkkp.github.io/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
            <a class="navbar-item btn-dark-mode" title="dark-mode" href="#">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="15" height="15" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 87.823 60.7 c -0.463 -0.423 -1.142 -0.506 -1.695 -0.214 c -15.834 8.398 -35.266 2.812 -44.232 -12.718 c -8.966 -15.53 -4.09 -35.149 11.101 -44.665 c 0.531 -0.332 0.796 -0.963 0.661 -1.574 c -0.134 -0.612 -0.638 -1.074 -1.259 -1.153 c -9.843 -1.265 -19.59 0.692 -28.193 5.66 C 13.8 12.041 6.356 21.743 3.246 33.35 S 1.732 57.08 7.741 67.487 c 6.008 10.407 15.709 17.851 27.316 20.961 C 38.933 89.486 42.866 90 46.774 90 c 7.795 0 15.489 -2.044 22.42 -6.046 c 8.601 -4.966 15.171 -12.43 18.997 -21.586 C 88.433 61.79 88.285 61.123 87.823 60.7 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #ffa716; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                </div>
            </a>
            
                <a class="navbar-item" href="/en/">English</a>
            
            

        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/05/05/Ethereum-1/" itemprop="url">Ethereum 初探 (1)</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-05-05T07:55:28.000Z" itemprop="datePublished">May 5, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Web3/">Web3</a><span>></span><a class="article-category-link" href="/categories/Web3/Ethereum/">Ethereum</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="以太坊官网">以太坊官网</span></h2><p><a target="_blank" rel="noopener" href="https://ethereum.org/zh/">以太坊官网</a></p>
<h2><span id="以太坊ethereum简介">以太坊（Ethereum）简介</span></h2><p>以太坊（Ethereum）是一个去中心化、开源并且具备智能合约功能的公共区块链平台，以太币（ETH）是以太坊的原生加密货币————摘自<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BB%A5%E5%A4%AA%E5%9D%8A">wikipedia 以太坊</a></p>
<h2><span id="以太坊的特点">以太坊的特点</span></h2><p>相较于较大多数其他加密货币或区块链技术，以太坊的特点包括以下几点：</p>
<ul>
<li><strong>智能合约：</strong>存储在区块链上的程序，由各节点执行，需要执行程序的人支付手续费给节点的矿工或权益人。</li>
<li><strong>分布式应用程序：</strong>以太坊上的分布式应用程序不会停机，也不能被关掉。</li>
<li><strong>代币（tokens）：</strong>智能合约可以创造代币供分布式应用程序使用。分布式应用程序的代币化让用户、投资者以及管理者的利益一致。代币也可以用来进行首次代币发行。</li>
<li><strong>权益证明：</strong>相较于工作量证明更有效率，可节省大量在挖矿时浪费的电脑资源，并避免特殊应用集成电路造成网络中心化。2022年9月15日与主链合并。</li>
<li><strong>燃料（gas）：</strong>由交易手续费的概念扩展，在执行各种运算时需计算燃料消耗量，并缴交燃料费，包括发送以太币或者其他代币也被视为一种运算动作。</li>
<li><strong>原丹克分片（Proto-Danksharding）：</strong>在部分节点上暂存资料，以提升效率（尚未实现）。</li>
<li><strong>叔块：</strong>此功能在转为权益证明后已停用。原本功能是使用有向无环图的相关技术，将因速度较慢而未及时被收入母链的较短区块链并入，用以提升交易量。</li>
</ul>
<h2><span id="以太坊是可编程的how">以太坊是可编程的？how</span></h2><p>经常有问题会问道：<strong>以太坊与比特币有什么不同？</strong> 二者都是虚拟货币？<br>以太坊立足比特币创新之上，于 2015 年启动，两者之间有一些显著不同。</p>
<p>两者都允许你使用数字货币，而无需支付服务提供商或银行。但是以太坊是可编程的，所以你还可以在以太坊网络上构建和部署去中心化应用程序。</p>
<h3><span id="账户模型">账户模型</span></h3><p>这不得不提到账户模型。<strong>比特币有两种类型的账户：用户账户和合约账户。</strong></p>
<p>以太坊的全局“共享状态”是有很多小对象（账户）来组成的，这些账户可以通过消息传递来与对方进行交互。每个账户都有一个与之关联的状态(state)和一个20字节的地址(address)。在以太坊中一个地址是160位的标识符，用来识别账户。</p>
<p>两种不同类型的账户：</p>
<ul>
<li><strong>外部拥有的账户，被私钥控制且没有任何代码与之关联</strong></li>
<li><strong>合约账户，被它们的合约代码控制且有代码与之关联</strong></li>
</ul>
<h3><span id="外部拥有账户与合约账户的比较">外部拥有账户与合约账户的比较</span></h3><p>理解外部拥有账户和合约账户的基本区别是很重要的。一个外部拥有账户可以通过创建和用自己的私钥来对交易进行签名，来发送消息给另一个外部拥有账户或合约账户。在两个外部拥有账户之间传送的消息只是一个简单的价值转移。但是从外部拥有账户到合约账户的消息会激活合约账户的代码，允许它执行各种动作。（比如转移代币，写入内部存储，挖出一个新代币，执行一些运算，创建一个新的合约等等）。</p>
<p><img src="/img/eth1/image1.png" alt="eth account"></p>
<p>不像外部拥有账户，合约账户不可以自己发起一个交易。相反，合约账户只有在接收到一个交易之后(从一个外部拥有账户或另一个合约账户处)，为了响应此交易而触发一个交易。</p>
<p><strong>因此，在以太坊上任何的动作，总是被外部拥有账户触发的交易所发动的。</strong></p>
<p>这也是为什么以太坊被称为一个“智能合约”平台，叫做可编程的原因。因为合约账户的代码可以被外部拥有账户调用，这样就可以执行一些操作。</p>
<h3><span id="账户状态">账户状态</span></h3><p>账户状态有四个组成部分，不论账户类型是什么，都存在这四个组成部分：</p>
<ul>
<li>nonce：如果账户是一个外部拥有账户，nonce代表从此账户地址发送的交易序号。如果账户是一个合约账户，nonce代表此账户创建的合约序号</li>
<li>balance： 此地址拥有Wei的数量。1Ether&#x3D;10^18Wei</li>
<li>storageRoot： Merkle Patricia树的根节点Hash值（我们后面在解释Merkle树）。Merkle树会将此账户存储内容的Hash值进行编码，默认是空值</li>
<li>codeHash：此账户EVM（以太坊虚拟机，后面细说）代码的hash值。对于合约账户，就是被Hash的代码并作为codeHash保存。对于外部拥有账户，codeHash域是一个空字符串的Hash值</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/04/19/web3DAO-1/" itemprop="url">Web3 DAO的迷思与自组织的互联网未来</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-04-19T02:15:47.000Z" itemprop="datePublished">April 19, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Web3/">Web3</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="web3-dao的迷思">Web3 DAO的迷思</span></h2><p>第一次接触到Web3 DAO还是在X上面，看到了以往的程序员郭宇对此的理解和实践 <a target="_blank" rel="noopener" href="https://guoyu.mirror.xyz/8Y05lOuKAZaVvA0hFlAkbVf7S7gyFMs7DTfNIfflCzg">CodeforDAO 的诞生与自组织的互联网未来</a></p>
<p>现在的Web3 DAO的市场还处于摸索阶段，可以看到Github上面存在着一些智能合约的雏形，但是还没有一个完整的DAO的生态。</p>
<p><strong>使用 DAO 的方法论来改善创业公司的架构，甚至，能否再进一步，允许任何人轻易地创建一个自组织的链上公司，链上组织。</strong></p>
<p>其实，你可以很轻易地在学校社团、公司、家庭、朋友圈等等，找到一些自组织的例子。这些自组织的例子，往往是由一群志同道合的人，通过一些共同的目标、规则、价值观等等，自发地组织在一起，共同实现一些目标。这与 DAO 不谋而合。</p>
<h2><span id="dao以及web3治理的挑战">DAO以及Web3治理的挑战</span></h2><p><strong><a target="_blank" rel="noopener" href="https://chain.link/education/web3">Web3</a> 之所以会出现，是因为中心化机构在管理金融和社会基础设施时无法保障安全性、公平性和透明性。</strong>Web3基于区块链和预言机等信任最小化的分布式网络建立，利用密码学、共识协议和机制设计来管理数字化基础设施，无需信任人类第三方，而是通过技术来实现保障，这就是所谓的“加密事实”。</p>
<h2><span id="dao是什么">DAO是什么？</span></h2><p><strong>DAO的全名是“decentralized autonomous organization”，中文是“去中心化的自治组织”。</strong>DAO的主要目的是超越传统组织形式，以分布式、透明和信任最小化的方式来进行集体决策。简而言之，DAO是一种新型的组织架构。人们可以独立验证组织的运行方式，并基于这样的共识朝着共同的目标努力。</p>
<p>更详细的解释，可以在这里看到：<a target="_blank" rel="noopener" href="https://blog.chain.link/daos-zh">一文读懂DAO以及Web3治理的挑战</a></p>
<p><strong>值得一提的是，虽然DAO的缩写中包含autonomous（自治）一词，但DAO并非完全自治。DAO是由人组成的，因此需要用户手动操作才能运行，比如用户需要进行投票、部署代码并讨论提案。</strong>之所以会使用“自治”这个词，是因为DAO的一些具体功能被写在了智能合约代码中，无法被篡改。然而，人们仍需要与智能合约（即：代码）交互（即：提供输入），以执行具体的任务（即：输出结果）。</p>
<h2><span id="dao的种类">DAO的种类</span></h2><p><strong>虽然DAO目前仍处于发展初期，但大致可以分为以下六种：</strong></p>
<p><em><strong>协议DAO</strong>——这类DAO负责开发和管理去中心化应用（dApp）或dApp的基础架构。协议DAO的主要任务是开发开源技术，这点类似于企业或基金会。</em></p>
<ul>
<li>Tezos是一条区块链，采用类似DAO的链上治理架构，通过代表制投票体系来触发协议升级，需要绝大多数人投票达成共识才能通过提案。</li>
<li>MakerDAO是一个组织，负责管理去中心化的stablecoin DAI。DAO成员负责为协议制定参数，比如调整利率、添加&#x2F;删除抵押资产以及核心部门团队入职&#x2F;离职。</li>
</ul>
<p><em><strong>投资DAO</strong>——这类DAO负责控制DAO金库中的资金，并使用这些资金来发起并管理投资。投资DAO的主要目的是为成员创造利润，这点与私募基金或对冲基金类似。</em></p>
<ul>
<li>BitDAO是一个DAO，BIT通证持有者通过投票决定各种投资策略，并为DAO金库实现收益。BitDAO宣称对Web3项目的投资额超过38亿美元。<br>MetaCartel Ventures (风投DAO)是一家营利性DAO，专门投资于早期dApp。其主要目的是以社区为中心建立会员制，参与机制比传统的风投基金更加灵活。</li>
</ul>
<p><em><strong>事业型DAO</strong>——这类DAO负责针对某一事业管理资金和计划。事业型DAO聚焦在某一领域达成共识，比如慈善、政治以及公用事业，这点与慈善组织、游说团体和奖金激励计划等传统组织类似。</em></p>
<ul>
<li>Gitcoin是一个DAO，用户在平台上可以通过二次方投票机制，共同为以太坊上的公用事业以及其他开源区块链项目募款。</li>
<li>Big Green是一个DAO，为学校、社区和家庭提供慈善奖金，帮助他们学习如何种植粮食。</li>
</ul>
<p><em><strong>社交DAO</strong>——这类DAO负责管理一个共享社交空间，共同拥有具有艺术价值的资产，为成员营造文化并组织活动。社交DAO围绕娱乐、艺术、游戏和其他社交领域将社区组织起来，这点类似于现代社交俱乐部。</em></p>
<ul>
<li>Bored Ape Yacht Club（BAYC）是限量版的NFT藏品，NFT既代表会员身份，又可以领取特殊福利。</li>
<li>Krause House是一个由篮球迷组成的社交DAO，目标是有朝一日买下一支NBA球队。Krause House DAO目前已经买下了Big3篮球联盟的球队Ball Hogs。</li>
</ul>
<p><em><strong>数据DAO</strong>——这类DAO负责开发和管理DAO控制的数据。数据DAO旨在将用户数据聚集在一起，或开发独特的数据产品卖给第三方用户，具体应用场景包括开发AI算法或展开市场调研。</em></p>
<ul>
<li>dClimate是一个买卖天气数据、天气预报和预测模型的市场，用户可以在其中销售创新的数据集，机构也可以在其中购买数据。这个DAO会评估发布的数据，以保障数据质量并发放适当的网络激励。</li>
<li>Delphia是机器人投资顾问，会支付原生通证购买用户个人数据。Delphia会将用户个人数据聚集在一起，并基于数据制定投资策略，用户可以使用原生通证查看这些投资策略。</li>
</ul>
<h2><span id="dao的治理架构">DAO的治理架构</span></h2><p>对于任何DAO来说，达成共识都是最重要也最具挑战的任务之一，因为达成共识意味着以去中心化的方式做出决策。下文列举了目前用于达成共识的几种治理机制，其中结合了上文提到的一些工具。</p>
<p><strong>直接的链上民主</strong>——指DAO成员直接在链上对提案进行投票，提案要通过必须满足上文提到的条件。大多数采用该模式的DAO都会使用通证加权投票机制，用户持有的通证数量决定了他的投票权重（通常1个通证&#x3D;1张选票）。这是DAO最常见也是最简单的共识达成方式，因为这种方式的复杂性和成本最低，而且可以抵御女巫攻击。</p>
<p><strong>直接的链下民主</strong>——指DAO使用快照在链下进行投票，投票要通过必须满足一定条件。多数采用这种模式的DAO也会使用通证加权投票机制，但需要可信实体通过多重签名的方式严格按照提案来执行链上变更。因此，链下民主需要一定信任假设，就是多重签名者会如实按照DAO投票结果的快照来投票。</p>
<p><strong>代表制民主</strong>——指DAO委托代表在链上投票，以通过DAO的提案。代表通常由DAO选出，并可能会参考链下快照来了解社区民意。DAO可能还会设置某种机制，当代表的投票结果严重偏离社区民意时对结果进行否决或变更。</p>
<p><strong>二次方民主</strong>——指基于二次方投票的治理架构，公式如下：投票者的成本&#x3D;（投票数量）^2。比如，对某一提案投一票需要花费一个治理通证，但如果要投五票就需要25个治理通证。二次方投票可以防止DAO的投票结果被少数巨鲸控制。多数成员的共同投票结果将拥有同等或甚至更大的效力。然而，要真正执行二次方投票，需要建立抗女巫攻击机制，以防止欺诈行为或将通证分散在不同钱包里。</p>
<h2><span id="web3-dao的未来与现状">Web3 DAO的未来与现状</span></h2><p><em>互联网上已经有相当多的 DAO，但大部分 DAO 似乎并不依赖于他们的基础合约而运行，换句话说，许多 DAO 采用<strong>广泛的人治</strong>，而<strong>有限地</strong>依赖<strong>合约治理</strong></em>。这些治理的目的都相当宏观，譬如，是否允许使用 DAO 金库的一些钱来完成一笔投资，或者是制定一个复杂的 Roadmap，由于目的过于宏观，这些治理大部分使用 snapshot 的链下投票来完成，它有点像我们熟悉的代议制民主：可以参与投票，但没有人能保证提案目的是否会得到完整执行。</p>
<blockquote>
<p>“网络国家是一个网络社会，在道德上创新，拥有国家意识和公认的创始人，有能力开展集体行动，人与人之间和谐相处，发行cryptocurrency，使用社会智能合约来约束基于共识的政府，通过众筹的方式买下实体领土并形成群岛，建立虚拟首都，在链上进行人口普查，证明国家人口、收入以及房地产，并因此获得外交地位。”</p>
</blockquote>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/04/14/http2-0/" itemprop="url">HTTP/2 简介</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-04-14T00:46:46.000Z" itemprop="datePublished">April 14, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Network/">Network</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="设计和技术目标">设计和技术目标</span></h2><p>早期版本的 HTTP 协议的设计初衷是为了简化实现：HTTP&#x2F;0.9 是用来引导万维网的一行协议；HTTP&#x2F;1.0 以信息性标准记录了 HTTP&#x2F;0.9 的热门扩展；HTTP&#x2F;1.1 则引入了官方 IETF 标准；请参阅 <a target="_blank" rel="noopener" href="https://hpbn.co/brief-history-of-http/">HTTP 简史</a> 。因此，HTTP&#x2F;0.9-1.x 可以完全实现其预期用途：HTTP 是互联网上最广泛采用的应用协议之一。</p>
<p>遗憾的是，实现简单是以牺牲应用性能为代价的：HTTP&#x2F;1.x 客户端需要使用多个连接来实现并发并缩短延迟时间；HTTP&#x2F;1.x 不会压缩请求和响应标头，从而导致不必要的网络流量；HTTP&#x2F;1.x 不允许有效的资源优先级排序，从而导致底层 TCP 连接被滥用；等等。</p>
<p>这些限制并不是致命的，但随着 Web 应用的范围、复杂性和在我们日常生活中的重要性不断增长，它们给 Web 开发者和用户造成了越来越大的负担，而这正是 HTTP&#x2F;2 旨在解决的问题：</p>
<p><strong>HTTP&#x2F;2 通过引入标头字段压缩并允许在同一连接上交错进行多个并发交换</strong>，可以更高效地利用网络资源并减少对延迟的感知。具体而言，它允许在同一连接上交错请求和响应消息，并对 HTTP 标头字段使用高效的编码。它还允许对请求进行优先级排序，让更重要的请求更快速地完成，从而进一步提升性能。</p>
<p>生成的协议对网络更友好，因为与 HTTP&#x2F;1.x 相比，可以使用的 TCP 连接更少。这意味着与其他流的竞争更少，并且连接的持续时间更长，进而可以更好地利用可用网络容量。最后，HTTP&#x2F;2 还可以通过使用二进制消息分帧来更高效地处理消息。（超文本传输协议版本 2，草稿 17）</p>
<p><strong>请务必注意，HTTP&#x2F;2 是对以前的 HTTP 标准的扩展，而不是取代。</strong>HTTP 的应用语义相同，提供的功能或核心概念（例如 HTTP 方法、状态代码、URI 和标头字段）没有发生任何变化。这些更改显然不在 HTTP&#x2F;2 工作的范围之内。也就是说，虽然高层级 API 保持不变，但了解低层级更改如何解决了先前协议的性能限制仍非常重要。我们来简单了解一下二进制分帧层及其功能。</p>
<h2><span id="二进制分帧层">二进制分帧层</span></h2><p>HTTP&#x2F;2 所有性能增强的核心是新的二进制分帧层，它规定了 HTTP 消息的封装方式，并在客户端和服务器之间传输。</p>
<p><img src="/img/http/image1.png" alt="HTTP/2 Frame"></p>
<p>“层”是指一种设计选择，用于在套接字接口与提供给应用的更高级别 HTTP API 之间引入一种经过优化的新编码机制：HTTP 语义（例如动词、方法和标头）不受影响，但其在传输过程中的编码方式有所不同。与以换行符分隔的 HTTP&#x2F;1.x 协议明文形式不同，所有 HTTP&#x2F;2 通信都会拆分为较小的消息和帧，其中的每个消息和帧都采用二进制格式进行编码。</p>
<p>因此，客户端和服务器都必须使用新的二进制编码机制来相互理解：HTTP&#x2F;1.x 客户端无法理解仅支持 HTTP&#x2F;2 的服务器，反之亦然。幸运的是，我们的应用仍可轻松了解所有这些变化，因为客户端和服务器会代表我们执行所有必要的取景工作。</p>
<blockquote>
<p>Binary protocol versus text protocol isn’t really about how binary blobs are encoded. The difference is really whether the protocol is oriented around data structures or around text strings. Let me give an example: HTTP. HTTP is a text protocol, even though when it sends a jpeg image, it just sends the raw bytes, not a text encoding of them.</p>
</blockquote>
<h2><span id="信息流-消息和帧">信息流、消息和帧</span></h2><p><img src="/img/http/image2.png" alt="HTTP/2 Frame"></p>
<p>新的二进制分帧机制改变了客户端与服务器之间的数据交换方式。为了描述此过程，我们需要先熟悉 HTTP&#x2F;2 术语：</p>
<ul>
<li>数据流：已建立的连接内的双向字节流，可承载一条或多条消息。</li>
<li>消息：映射到逻辑请求或响应消息的完整帧序列。</li>
<li>帧：HTTP&#x2F;2 中的最小通信单元，每个单元包含一个帧标头，至少标识该帧所属的数据流。</li>
</ul>
<p>这些术语之间的关系可总结如下：</p>
<ul>
<li>所有通信都在一个 TCP 连接上完成，该连接可以承载任意数量的双向数据流。</li>
<li>每个数据流都有一个唯一标识符和可选的优先级信息，用于承载双向消息。</li>
<li>每条消息都是一条逻辑 HTTP 消息（例如请求或响应），包含一个或多个帧。</li>
<li><strong>帧是最小的通信单位，承载着特定类型的数据，例如，HTTP 标头、邮件载荷等</strong>。来自不同数据流的帧可以交错，然后通过每个帧标头中的嵌入式数据流标识符重新组装。</li>
</ul>
<p>也就是说，<strong>HTTP&#x2F;2 的每个消息都由一个或多个帧组成，这些帧可以交错发送，然后再在接收端重新组装。帧的顺序并不重要，因为每个帧都包含其相对位置的信息。</strong></p>
<h2><span id="请求和响应多路复用">请求和响应多路复用</span></h2><p><strong>使用 HTTP&#x2F;1.x 时，如果客户端想要发出多个并行请求以提高性能，则必须使用多个 TCP 连接（请参阅使用多个 TCP 连接）。</strong></p>
<p><em><strong>注意这里是并行！！</strong></em><br>客户端往往会为每个请求创建一个新的连接，以便并行发送请求，达到性能最大化。然而，这种方法会导致一些问题。</p>
<p>这是 HTTP&#x2F;1.x 传送模型的直接结果，该行为可确保每个连接一次只传送一个响应（响应排队）。<strong>更糟糕的是，这也会导致队首阻塞，以及底层 TCP 连接的效率低下。</strong></p>
<p>HTTP&#x2F;2 中新的二进制分帧层消除了这些限制并实现了完整的请求和响应多路复用，方法是允许客户端和服务器将 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装这些帧。</p>
<p>该快照捕捉了同一连接内传输的多个数据流。客户端正在向服务器传输 DATA 帧（流 5），而服务器正在将交错的帧序列发送到客户端，以便流 1 和流 3。因此，正在传输三个并行流。</p>
<p>能够将 HTTP 消息分解为独立的帧，交错这些帧，然后在另一端重新组装这些帧，是 HTTP&#x2F;2 最重要的增强功能。事实上，它在所有 Web 技术的整个堆栈中带来了众多性能优势的连锁效应，使我们能够：</p>
<ul>
<li>并行交错地发送多个请求，请求之间互不影响。</li>
<li>并行交错地发送多个响应，响应之间互不影响。</li>
<li>使用一个连接并行发送多个请求和响应。</li>
<li>移除了不必要的 HTTP&#x2F;1.x 权宜解决方法（请参阅针对 HTTP&#x2F;1.x 进行优化，例如串联文件、image sprites 和网域分片）。</li>
<li>消除不必要的延迟并提高可用网络容量的利用率，从而缩短网页加载时间。</li>
<li>等等…</li>
</ul>
<p>HTTP&#x2F;2 中新的二进制分帧层解决了 HTTP&#x2F;1.x 中存在的队首阻塞问题，并且消除了并行处理及传送请求和响应所需的多个连接。因此，我们的应用部署速度更快、操作更简单、部署成本更低。</p>
<h2><span id="数据流优先级">数据流优先级</span></h2><p>一旦 HTTP 消息可以拆分为多个单独的帧，并且我们允许对来自多个数据流的帧进行多路复用，那么客户端和服务器交错和传送这些帧的顺序就成为关键的性能考虑因素。为了方便起见，HTTP&#x2F;2 标准允许每个数据流具有关联的权重和依赖关系：</p>
<ul>
<li>可以为每个数据流分配一个介于 1 到 256 之间的整数。</li>
<li>每个数据流都可以显式依赖于另一个数据流。</li>
</ul>
<p>通过结合使用数据流依赖关系和权重，客户端可以构建和传递“优先级树”，表明其希望如何接收响应。反过来，服务器可以使用这些信息通过控制 CPU、内存和其他资源的分配来确定流处理的优先级，并在响应数据可用后分配带宽，以确保将高优先级响应以最优方式传递给客户端。</p>
<p><img src="/img/http/image3.png" alt="HTTP/2 Frame"></p>
<h2><span id="每个源一个连接">每个源一个连接</span></h2><p><strong>有了新的二进制分帧机制，HTTP&#x2F;2 不再需要多个 TCP 连接来并行复用数据流；</strong>每个数据流都会拆分为许多帧，这些帧可以交错并设定优先级。因此，所有 HTTP&#x2F;2 连接都是永久性的，并且每个来源只需要一个连接，从而提供大量性能优势。</p>
<p>SPDY 和 HTTP&#x2F;2 的杀手级功能是，在单个拥塞受控的通道上任意进行多路复用。它的重要性和良好运作机制让我惊叹不已我喜欢的一个重要指标是创建的连接所占的比例，这些连接仅承载单个 HTTP 事务（因此该事务承担所有开销）。对于 HTTP&#x2F;1，我们 74% 的活动连接只承载一个事务 - 持久性连接没有我们所有人想要的那样帮助。但在 HTTP&#x2F;2 中，这一比例下降至 25%。 这在减少开销方面是一项巨大的成功。（HTTP&#x2F;2 已在 Firefox 中推出，Patrick McManus）</p>
<p><strong>大多数 HTTP 传输都是短暂的且具有突发性的，而 TCP 则针对长期的批量数据传输进行了优化。通过重复使用同一连接，HTTP&#x2F;2 既可以更有效地利用每个 TCP 连接，也可以显著降低整体协议开销。</strong>此外，使用较少的连接可以减少整个连接路径（即客户端、中间服务器和源服务器）上的内存和处理占用空间。这样可以降低整体运营费用，并提高网络利用率和容量。因此，改用 HTTP&#x2F;2 不仅可以减少网络延迟，还有助于提高吞吐量并降低运营费用。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/02/28/FE-interview-guide/" itemprop="url">FE-interview-guide</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-02-28T02:04:38.000Z" itemprop="datePublished">February 28, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Security/">Security</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1><span id="codewave">CodeWave</span></h1><p>CodeWave: 汇集开发者线下技术会议的导航，链接你与技术界的最新动态和机遇。</p>
<h2><span id="技术会议主页">技术会议主页</span></h2><h3><span id="国内">国内</span></h3><ul>
<li><p><a target="_blank" rel="noopener" href="http://www.thegiac.com/index.php">GIAC全球互联网架构大会</a> - 集中探讨互联网架构的发展趋势，邀请业内顶尖的架构师分享他们的经验和见解。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://qcon.infoq.cn/">QCon全球软件开发大会</a> - 聚焦软件开发的最新趋势和技术，旨在为软件开发者提供一个学习和交流的平台。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://d2.alibabatech.com/">D2 终端技术大会</a> - 由阿里巴巴主办，专注于前端及移动开发领域的技术创新和实践交流。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://conf.juejin.cn/">稀土开发者大会</a> - 面向广大开发者，分享最前沿的技术动态和开发经验。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gmtc.infoq.cn/">GMTC全球大前端技术大会</a> - 聚焦大前端领域的最新技术和应用实践，旨在推动前端技术的创新和发展。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://sz2019.archsummit.com/">ArchSummit全球架构师峰会</a> - 针对软件架构领域，邀请知名架构师分享架构设计的最佳实践和经验。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.zaozao.run/">前端早早聊大会</a> - 一个面向前端社区的分享和交流平台，旨在促进前端技术和经验的分享。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://node.fequan.com/">VueConf</a> - 面向Vue.js社区的开发者和爱好者，分享Vue.js的最新进展和应用案例。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://cssconf.org/">CssConf</a> - 集中探讨CSS相关的技术、工具和最佳实践，旨在推动CSS技术的发展。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.w3.org/2023/06/china-web-forum/">Web前沿技术论坛</a> - 由W3C主办，探讨Web技术的最新标准和发展趋势。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.csdisummit.com/">中国软件研发管理行业技术峰会</a> - 聚焦软件研发管理领域，分享管理实践和创新方法。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://devopschina.org/">中国DevOps社区</a>, <a target="_blank" rel="noopener" href="https://www.hdb.com/u/bqaf3u.html">近期活动</a> - 专注于DevOps文化和实践的推广，组织相关的活动和交流。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://meetup.elasticsearch.cn/event/index.html">Elastic Meetup - Elastic 官方中文社区定期举办的线下交流活动</a> - 面向Elasticsearch用户和开发者的交流活动，分享使用经验和最佳实践。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://jsworldconference.com/">JS World</a> - 世界上最大的 JavaScript 会议，涵盖 JavaScript 的各个方面，邀请业界知名公司和组织的演讲嘉宾，提供技术更新和案例研究。最近一次举办于 2024.2.28。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://vuejs.amsterdam/">VueJS Amsterdam</a> - 规模最大的 Vue 会议，汇集全球参与者，与 Vue 创作者和维护者互动，建立联系并获得终生难忘的体验。最近一次举办于 2024.2.28。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://us.vuejs.org/">VueConf US</a> - Vue.js 社区组织的年度会议，由 Vue.js 创建者和核心团队主持，聚集全球 Vue.js 开发者和爱好者，分享最新技术和经验。最近一次举办于 2023.5.24。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://reactsummit.com/">React Summit</a>, <a target="_blank" rel="noopener" href="https://reactsummit.us/">React Summit US</a> - 全球最大的 React 会议，汇集 React 开发者、工程师和专家，分享 React 相关的技术和行业动态。最近一次举办于 2023.5.24 和 2023.11.13。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://reactlive.nl/">React Live</a> - 与 500 名 React 开发人员一起参加一天的 React 庆典，深入探讨 React 相关的最新主题。最近一次举办于 2023.9.29。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://devworldconference.com/">DEV WORLD</a> - 全球排名第一的开发者大会，提供与 7500 名开发人员面对面交流的机会，涵盖多个技术领域。最近一次举办于 2024.2.29。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://viteconf.org/23/">Vite Conf</a> - 沉浸式互动在线活动，面向前端团队，探讨使用 Vite 构建下一代网络。最近一次举办于 2023.10.5。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cssday.nl/2023">CSS Day</a> - 高级 CSS 会议，提供轻松氛围和深入的讨论。最近一次举办于 2024.6.8。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.fequan.com/">FEday</a> </p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.react-next.com/">ReactNext</a> - 以色列最大的 React 框架会议，汇集本地和国际演讲者，分享高级主题。最近一次举办于 2024.6.24。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://jsheroes.io/">JSHeroes</a> - 非营利性社区组织的会议，汇集全球 JS 和 Web&#x2F;前端开发爱好者，提供演讲和网络活动。最近一次举办于 2024.5.23。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://javascript-conference.com/munich/">iJS</a> - 国际 JavaScript 大会，关注 JavaScript 的最新趋势和变革。最近一次举办于 2023.10.23。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://ng-conf.org/">ng-conf</a> - Angular 社区最大规模的年度技术峰会，邀请知名演讲嘉宾分享 Angular 相关经验和最佳实践。最近一次举办于 2023.6.14。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bagevent.com/event/gops2023">GOPS 2023全球运维大会</a> - 全球运维领域的年度大会，聚焦于最新的运维技术和实践。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://dtcc.it168.com/">DTCC 中国数据库技术大会</a> - 专注于数据库技术的交流和分享，汇集众多数据库领域的专家和技术爱好者。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bagevent.com/event/8384949">Gdevops 全球敏捷运维峰会</a> - 探讨敏捷运维的最佳实践和前沿技术，旨在提高运维效率和质量。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://archsummit.infoq.cn/2024/shenzhen">ArchSummit 全球架构师峰会</a> - 集结全球顶尖架构师，分享架构设计的最新理念和技术。</p>
</li>
<li><p><a href>KubeCon + CloudNativeCon</a> - Kubernetes和云原生社区的年度聚会，分享云原生技术的最新进展。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://pm-summit.org/modao">2019产品经理大会</a> - 针对产品经理的专业大会，探讨产品管理的理念、工具和最佳实践。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://wot.51cto.com/act/wot2023/shenzhen/">WOT 全球人工智能技术峰会</a> - 聚焦人工智能技术的前沿进展，汇集AI领域的研究者和实践者。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://nsc.skdlabs.com/">NSC中国网络安全大会</a> - 专注于网络安全领域的交流和分享，旨在提升网络安全意识和技能。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.bagevent.com/event/2414051">DOIS 2019运维开发国际峰会</a> - 探讨运维与开发的融合，促进DevOps文化和实践的发展。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gtlc.infoq.cn/2021/shanghai">GTLC全球技术领导力大会</a> - 聚焦技术领导力的培养和发展，为技术领导者提供交流和学习的平台。</p>
</li>
</ul>
<h2><span id="活动发布平台">活动发布平台</span></h2><ul>
<li><a target="_blank" rel="noopener" href="https://hopin.com/explore">hopin</a></li>
<li><a target="_blank" rel="noopener" href="https://www.meetup.com/">Meetup: We are what we do</a></li>
<li><a target="_blank" rel="noopener" href="https://www.eventbrite.com/">Eventbrite - Discover Great Events or Create Your Own &amp; Sell Tickets</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/salon">腾讯云+社区沙龙</a></li>
<li><a target="_blank" rel="noopener" href="http://www.huodongxing.com/">活动行-可以多留意这里</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/events">segmentfault-活动</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/events/all">掘金-活动</a></li>
<li><a target="_blank" rel="noopener" href="https://www.huodongjia.com/">活动家</a> ，有<a target="_blank" rel="noopener" href="https://doc.huodongjia.com/">会议PPT区</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bagevent.com/">百格活动</a></li>
<li><a target="_blank" rel="noopener" href="https://opentalk.upyun.com/">又拍云OpenTalk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hdb.com/">互动吧</a></li>
<li><a target="_blank" rel="noopener" href="https://yoopay.cn/collect/search/event">友付活动票务</a></li>
</ul>
<h2><span id="组织">组织</span></h2><ul>
<li><a target="_blank" rel="noopener" href="https://linuxfoundation.cn/">Linux基金会</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cncf.io/">云原生软件基金会 CNCF </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/d2forum">D2 前端技术论坛 - 阿里经济体前端委员会主办的面向全球前端领域的技术论坛 </a></li>
</ul>
<h2><span id="相关资源推荐">相关资源推荐</span></h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/SpringCloud/spring-cloud-document">SpringCloud中国社区 2017-2018活动汇总</a></li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/02/16/pm-post1/" itemprop="url">产品思考与产品用户体验优化</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-02-16T07:08:02.000Z" itemprop="datePublished">February 16, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/%E4%BA%A7%E5%93%81/">产品</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="产品用户体验优化">产品用户体验优化</span></h2><p>自己做了独立开发，最多的问题就是：怎么推广，怎么获客？」但我遇到的绝大多数的提出这个问题的人，产品都发布了，都没有过太多思考。</p>
<p>问题之所以发生，是因为之前的问题没有解决。站在问题链末端，很多问题是无法解决的。这就像鲁伯特之泪，拿锤子拼命砸它，不如用钳子剪断末梢。</p>
<p>往往解决问题的方式并不是回答问题本身，而是从上游出发解决核心矛盾。</p>
<p>如果你的独立产品期望快速找到100个狂热用户，通过他们快速增长，那请牢牢记住这四件事，并围绕这四件事不断向自己提问，找到解决方案：</p>
<p><strong>1、定位目标用户，勾勒画像，了解当下用户遇到的问题</strong><br><strong>2、提供新解决方案，确定核心功能解决核心痛点</strong><br><strong>3、包装，写广告语，做落地页</strong><br><strong>4、冷启动，找到100个狂热用户</strong></p>
<h2><span id="选择赛道定义目标用户">选择赛道，定义目标用户：</span></h2><ol>
<li>你的用户是谁？具体画像是什么样？他们兜里有钱吗？</li>
<li>现在这个时间点做这个事情，是最佳时间吗？有没有什么时刻，比现在更容易做？</li>
<li>有什么政策支持或政策风险吗？</li>
<li>这个产品，只能你在其中挣钱吗？怎么能让别人，也通过你的产品挣钱？</li>
<li>这件事只能你来做吗？你做这件事，有什么额外的优势吗？</li>
<li>在你产品上线后，有可以合作进行销售的现成渠道资源吗？</li>
<li>你觉得你的产品，是具有很直接价值感的产品吗？还是需要教育用户才能意识到产品价值的？</li>
<li>和你做相同事情的竞品，多吗？他们做的如何？</li>
<li>用户对竞品的差评里，在抱怨什么？</li>
</ol>
<h2><span id="定义产品核心功能">定义产品核心功能</span></h2><ol>
<li>你的产品帮助他做了什么？这个过程，他现在是怎么完成的？</li>
<li>现在在持续完成这个过程的人，在你的用户画像中，占比有多高？</li>
<li>他如果不用你，想达到相同效果，还有什么其他替代方案？效率上和用你的产品相比，能相差多少？</li>
<li>如果你只有一个核心功能或链路，用户为其付费，这个功能是什么？</li>
<li>有什么现成工具，可以帮助你快速构建这个链路吗？（或者完成初步测试）</li>
</ol>
<h2><span id="确定营销包装">确定营销包装</span></h2><ol>
<li>你的用户，究竟为你产品的哪个点付费？该如何凸显，才能让用户感觉这个点对他们有用？</li>
<li>请用一句话打动客户为你的产品付费，这句话是什么？</li>
<li>竞品包装的打动用户的点是什么？和你有差异化吗？</li>
<li>如果没有差异，竞品的劣势是什么？是否可以将它的劣势转化为你的优势？进行精准打击？用户在意这个点吗？</li>
</ol>
<h2><span id="冷启动与扩量">冷启动与扩量</span></h2><ol>
<li>你的目标用户在哪里聚集？</li>
<li>你初期如何找到他们？</li>
<li>你能依靠哪些资源或人，来变相触及到他们？</li>
<li>当他们想要找你这类产品时，最可能从哪些渠道发现？搜索的关键词是？</li>
<li>竞品都在哪里做广告？</li>
<li>最有可能帮你去卖你产品的人，是谁？</li>
</ol>
<h2><span id="天使投资选择关注技术变革和应用场景">天使投资选择：关注技术变革和应用场景</span></h2><p>如果去做天使投资，我现在会看什么类型的项目？</p>
<p>天使投资是最难做的，很多基金DPI都小于1，投不好基本就融不到钱了。所以如果是我，我会怎么选择？</p>
<p>我请教了一个朋友，朋友讲了一个技术变革周期的故事。</p>
<p>从上一轮苹果开始，先是科研人员有了一些成果，促使底层技术有了革命性进展。然后出现了iphone时刻。之后伴随着一路网络基础设施建设，以及一些底层开发生态的建设，把原来web时代的场景，迁移到了移动终端上。当越来越多的场景迁移完成，开始卷不动了，人们就开始去做新场景的创新，出现了抖音，拼多多这种巨头。应用侧没的卷了，就开始卷内容，无数多的人挤进去做内容创新。</p>
<p>这个路线，放到AI上也一样可以借鉴的。新技术变革就像GPT3.5出现时一样，前期也是在卷模型，RAG，infra，所以这种做底层基建的，是会考虑投入的。因为长期来看，生态需要它。在每个赛道总是能跑出1，2个头部并持续发展下去的。</p>
<p>然而目前我们还没进入旧场景迁移的时候，目测现在的应用层还远远达不到真正实用的要求，所以暂时也不会考虑投入。很可能技术的势头一到，重新做旧场景迁移，会比现在快的多。那现在创业者做的事情，往往就会成为技术债务，船大难掉头。所以目前不会投这块的项目。</p>
<p>我感觉大家思路都差不多，我考量的是AI应用不成熟，所以会选择做AI流量直接变现，或者toB去做服务解决方案，而不是自己做个东西。</p>
<p>但其实AI应用里也会拆分，往往也有底层的应用范畴。比如和infra层对接比较紧密的，抽象能力足够强以至于可以应对变化的这种项目，也是值得看的。</p>
<p>这个思路其实也适用于visionOS带来的空间计算变革，只是感觉visionOS才刚刚走到新技术变革—&gt;底层基础建设 这块。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/02/08/elementUI-1/" itemprop="url">记录一次向elementUI提PR的过程</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-02-08T01:49:54.000Z" itemprop="datePublished">February 8, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Vue/">Vue</a><span>></span><a class="article-category-link" href="/categories/Vue/ElementUI/">ElementUI</a><span>></span><a class="article-category-link" href="/categories/Vue/ElementUI/PR/">PR</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="前言">前言</span></h2><p>24年的年度目标其中就有一个是进入开源社区，而万事开头难，一开始选了VueCore和ElementUI作为我的开始，也向VueCore交了一个PR，但是没发现这个issue上一周就被修复了，所以就没了下文。</p>
<p>但是ElementUI的issue挺有意思的，下面我们来细说下：</p>
<h2><span id="问题">问题</span></h2><p>issue长这样：<a target="_blank" rel="noopener" href="https://github.com/element-plus/element-plus/issues/15308">牙齿尖尖的</a></p>
<p>这边也贴一个SFC的链接吧：<a target="_blank" rel="noopener" href="https://element-plus.run/#eyJzcmMvQXBwLnZ1ZSI6IjxzY3JpcHQgc2V0dXA+XG5pbXBvcnQgeyByZWYsIHZlcnNpb24gYXMgdnVlVmVyc2lvbiB9IGZyb20gJ3Z1ZSdcbmltcG9ydCB7IEVsTWVudSwgRWxNZW51SXRlbSwgdmVyc2lvbiBhcyBlcFZlcnNpb24gfSBmcm9tICdlbGVtZW50LXBsdXMnXG5pbXBvcnQgeyBFbGVtZW50UGx1cyB9IGZyb20gJ0BlbGVtZW50LXBsdXMvaWNvbnMtdnVlJ1xuXG48L3NjcmlwdD5cblxuPHRlbXBsYXRlPlxuICA8ZWwtbWVudVxuICAgIG1vZGU9XCJob3Jpem9udGFsXCJcbiAgPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIxXCI+UHJvY2Vzc2luZyBDZW50ZXI8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtc3ViLW1lbnUgaW5kZXg9XCIyXCI+XG4gICAgICA8dGVtcGxhdGUgI3RpdGxlPldvcmtzcGFjZTwvdGVtcGxhdGU+XG4gICAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMi0xXCI+aXRlbSBvbmU8L2VsLW1lbnUtaXRlbT5cbiAgICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyLTJcIj5pdGVtIHR3bzwvZWwtbWVudS1pdGVtPlxuICAgICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjItM1wiPml0ZW0gdGhyZWU8L2VsLW1lbnUtaXRlbT5cbiAgICAgIDxlbC1zdWItbWVudSBpbmRleD1cIjItNFwiPlxuICAgICAgICA8dGVtcGxhdGUgI3RpdGxlPml0ZW0gZm91cjwvdGVtcGxhdGU+XG4gICAgICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyLTQtMVwiPml0ZW0gb25lPC9lbC1tZW51LWl0ZW0+XG4gICAgICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyLTQtMlwiPml0ZW0gdHdvPC9lbC1tZW51LWl0ZW0+XG4gICAgICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyLTQtM1wiPml0ZW0gdGhyZWU8L2VsLW1lbnUtaXRlbT5cbiAgICAgIDwvZWwtc3ViLW1lbnU+XG4gICAgPC9lbC1zdWItbWVudT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiM1wiIGRpc2FibGVkPkluZm88L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiNFwiPk9yZGVyczQ8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiNVwiPk9yZGVyczU8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiNlwiPk9yZGVyczY8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiN1wiPk9yZGVyczc8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiOFwiPk9yZGVyczg8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiOVwiPk9yZGVyczk8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMTBcIj5PcmRlcnMxMDwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIxMVwiPk9yZGVyczExPC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjEyXCI+T3JkZXJzMTI8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMTNcIj5PcmRlcnMxMzwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIxNFwiPk9yZGVyczE0PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjE1XCI+T3JkZXJzMTU8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMTZcIj5PcmRlcnMxNjwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIxN1wiPk9yZGVyczE3PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjE4XCI+T3JkZXJzMTg8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMTlcIj5PcmRlcnMxOTwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyMFwiPk9yZGVyczIwPC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjIxXCI+T3JkZXJzMjE8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMjJcIj5PcmRlcnMyMjwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyM1wiPk9yZGVyczIzPC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjI0XCI+T3JkZXJzMjQ8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMjVcIj5PcmRlcnMyNTwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyNlwiPk9yZGVyczI2PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjI3XCI+T3JkZXJzMjc8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMjhcIj5PcmRlcnMyODwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIyOVwiPk9yZGVyczI5PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjMwXCI+T3JkZXJzMzA8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMzFcIj5PcmRlcnMzMTwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIzMlwiPk9yZGVyczMyPC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjMzXCI+T3JkZXJzMzM8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMzRcIj5PcmRlcnMzNDwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIzNVwiPk9yZGVyczM1PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjM2XCI+T3JkZXJzMzY8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiMzdcIj5PcmRlcnMzNzwvZWwtbWVudS1pdGVtPlxuICAgIDxlbC1tZW51LWl0ZW0gaW5kZXg9XCIzOFwiPk9yZGVyczM4PC9lbC1tZW51LWl0ZW0+XG4gICAgPGVsLW1lbnUtaXRlbSBpbmRleD1cIjM5XCI+T3JkZXJzMzk8L2VsLW1lbnUtaXRlbT5cbiAgICA8ZWwtbWVudS1pdGVtIGluZGV4PVwiNDBcIj5PcmRlcnM0MDwvZWwtbWVudS1pdGVtPlxuICA8L2VsLW1lbnU+XG5cbiAgPHA+XG4gICAgPGVsLWljb24gY29sb3I9XCJ2YXIoLS1lbC1jb2xvci1wcmltYXJ5KVwiPjxFbGVtZW50UGx1cyAvPjwvZWwtaWNvbj5cbiAgICBFbGVtZW50IFBsdXMge3sgZXBWZXJzaW9uIH19ICsgVnVlIHt7IHZ1ZVZlcnNpb24gfX1cbiAgPC9wPlxuPC90ZW1wbGF0ZT5cbiIsImltcG9ydC1tYXAuanNvbiI6IntcbiAgXCJpbXBvcnRzXCI6IHt9XG59IiwidHNjb25maWcuanNvbiI6IntcbiAgXCJjb21waWxlck9wdGlvbnNcIjoge1xuICAgIFwidGFyZ2V0XCI6IFwiRVNOZXh0XCIsXG4gICAgXCJqc3hcIjogXCJwcmVzZXJ2ZVwiLFxuICAgIFwibW9kdWxlXCI6IFwiRVNOZXh0XCIsXG4gICAgXCJtb2R1bGVSZXNvbHV0aW9uXCI6IFwiQnVuZGxlclwiLFxuICAgIFwidHlwZXNcIjogW1wiZWxlbWVudC1wbHVzL2dsb2JhbC5kLnRzXCJdLFxuICAgIFwiYWxsb3dJbXBvcnRpbmdUc0V4dGVuc2lvbnNcIjogdHJ1ZSxcbiAgICBcImFsbG93SnNcIjogdHJ1ZSxcbiAgICBcImNoZWNrSnNcIjogdHJ1ZVxuICB9LFxuICBcInZ1ZUNvbXBpbGVyT3B0aW9uc1wiOiB7XG4gICAgXCJ0YXJnZXRcIjogMy4zXG4gIH1cbn1cbiIsIl9vIjp7fX0=">SFC</a></p>
<p>刚看到这个issue还挺有意思的：这个bug是在菜单组件过多时，elementUI会将过长的menu进行收纳进一个展开栏中：</p>
<p><img src="/img/element/element-1.png" alt="elementUI"></p>
<p>也就是上图中的省略号那个区域</p>
<p>当我们hover或者click那个区域时，会弹出一个展开栏，里面包含了所有的菜单</p>
<p>但是这个issue的问题是，当我们点击展开栏，当菜单栏的长度过多，会导致展开栏的长度过长，页面会往下拓展，导致页面的滚动条出现，后面页面的视宽内容会被挤压。</p>
<p><strong>挤压不要紧，这个应该是符合预期的，因为当菜单栏过多时，我们的展开栏的长度也会变长，他就需要有地方进行拓展。</strong></p>
<p>但是问题是，这个组件有一个节流函数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">getIndexPath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">index</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=></span> subMenus<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>indexPath

<span class="token comment">// Common computer monitor FPS is 60Hz, which means 60 redraws per second. Calculation formula: 1000ms/60 ≈ 16.67ms, In order to avoid certain chance of repeated triggering when `resize`, set wait to 16.67 * 2 = 33.34</span>
<span class="token keyword">const</span> <span class="token function-variable function">debounce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span> wait <span class="token operator">=</span> <span class="token number">33.34</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">let</span> <span class="token literal-property property">timmer</span><span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> setTimeout<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    timmer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timmer<span class="token punctuation">)</span>
    timmer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> isFirstTimeRender <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sliceIndex<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token function">calcSliceIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
   <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    sliceIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
       sliceIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">calcSliceIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span>    <span class="token comment">// execute callback directly when first time resize to avoid shaking</span>
   isFirstTimeRender <span class="token operator">?</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">debounce</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   isFirstTimeRender <span class="token operator">=</span> <span class="token boolean">false</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>他是这样的：当我们页面的视宽发生变化时，会触发resize事件，然后会执行handleResize函数，这个函数会计算当前的菜单栏的长度，然后会执行一个节流函数，这个节流函数会在一定的时间内，只执行一次回调函数，这个回调函数就是计算当前的菜单栏的长度，然后将这个长度赋值给sliceIndex，然后页面就会根据这个长度来进行展开栏的展开。</p>
<p><strong>搞笑的就来了：刚刚我们触发的滚动条，使得这个节流函数的触发，页面就开始抽搐了</strong> ，因为这个节流函数的节流时间是33.34ms，而我们的滚动条的触发频率是16.67ms，所以这个节流函数就会被频繁的触发，导致页面的抽搐。</p>
<h2><span id="解决">解决</span></h2><p>那么怎么solve这个问题呢：</p>
<p>我一开始想到的是改这个scss的样式，但是这个样式是根据菜单栏的长度来进行展开的，所以改样式是不行的。</p>
<p>后面我发现这个节流函数的触发应该是来解决拖动视窗时组件的销毁和重建，那么我们有必要这么频繁的触发这个节流函数吗？我们是否可以将当他改变组件数量的时候再进行触发呢？</p>
<p>所以在原来的代码中加了一行：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>sliceIndex<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token function">calcSliceIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个问题整体来说还算简单，但是我觉得这个问题还是挺有意思的，所以就记录下来了。</p>
<p>提了这个PR也让我复习了一下git的操作，以及体验到了开源项目的PR流程和规范，还是挺有意思的。</p>
<p>下一个阶段的小目标：向Vue和elementUI提PR，看能不能有机会进core team！</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/01/31/mathjax-latex/" itemprop="url">基于Vue3和MathJax渲染的Latex富文本公式编辑器完美实践</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-01-31T13:07:42.000Z" itemprop="datePublished">January 31, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Vue/">Vue</a><span>></span><a class="article-category-link" href="/categories/Vue/MathJax/">MathJax</a><span>></span><a class="article-category-link" href="/categories/Vue/MathJax/Latex/">Latex</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="前言">前言</span></h2><p>做项目需要用到富文本编辑器，但是看了很多的富文本编辑器都很少支持公式编辑，但项目有要用到，怎么办呢？先写一个显然并不现实。于是使用<code>easy-formula-editor</code>和<code>wangeditor</code>写了一个功能小插件，是 <strong>基于Vue3和MathJax渲染的Latex富文本公式编辑器，支持零基础即可编辑公式，支持自定义编辑器配置和风格，支持二次编辑公式，支持作为插件和富文本编辑器一起使用。</strong></p>
<ul>
<li>零基础即可编辑公式</li>
<li>支持自定义编辑器配置和风格</li>
<li>支持二次编辑公式</li>
<li>支持作为插件和富文本编辑器一起使用</li>
</ul>
<p><img src="/img/mathjax/mathjax-1.png" alt="MathJax"></p>
<h2><span id="安装和使用">安装和使用</span></h2><h3><span id="npm">NPM</span></h3><pre class="line-numbers language-none"><code class="language-none">npm i easy-formula-editor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> formulaEditor <span class="token keyword">from</span> <span class="token string">"easy-formula-editor"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formulaEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'#test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3><span id="cdn">CDN</span></h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../dist/formula-editor.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formulaEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  editor<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'#test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3><span id="导出">导出</span></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// latex 公式</span>
editor<span class="token punctuation">.</span>latex<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// html 公式</span>
editor<span class="token punctuation">.</span>$textSvgElem<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2><span id="富文本编辑器菜单栏扩展">富文本编辑器菜单栏扩展</span></h2><h3><span id="注册菜单">注册菜单</span></h3><p><strong>【注意】 推荐使用全局模式来注册菜单。</strong> 如果有多个编辑器，每个编辑器的自定义菜单不一样，则使用实例的方式来注册菜单</p>
<h3><span id="全局模式">全局模式</span></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 菜单 key ，各个菜单不能重复</span>
<span class="token keyword">const</span> menuKey <span class="token operator">=</span> <span class="token string">'alertMenuKey'</span> 

<span class="token comment">// 注册菜单</span>
<span class="token constant">E</span><span class="token punctuation">.</span><span class="token function">registerMenu</span><span class="token punctuation">(</span>menuKey<span class="token punctuation">,</span> AlertMenu<span class="token punctuation">)</span>

<span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token string">'#div1'</span><span class="token punctuation">)</span>
editor<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> editor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token string">'#div2'</span><span class="token punctuation">)</span>
editor2<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3><span id="实例模式">实例模式</span></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 菜单 key ，各个菜单不能重复</span>
<span class="token keyword">const</span> menuKey <span class="token operator">=</span> <span class="token string">'alertMenuKey'</span> 
<span class="token keyword">const</span> menuKey2 <span class="token operator">=</span> <span class="token string">'alertMenuKey2'</span>

<span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token string">'#div1'</span><span class="token punctuation">)</span>
<span class="token comment">// 注册菜单</span>
editor<span class="token punctuation">.</span>menus<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>menuKey<span class="token punctuation">,</span> AlertMenu<span class="token punctuation">)</span>

<span class="token comment">// 将菜单加入到 editor.config.menus 中    const menuKey = 'alertMenuKey' </span>
<span class="token comment">// 也可以通过配置 menus 调整菜单的顺序，参考【配置菜单】部分的文档    editor.config.menus.push(menuKey)</span>
editor<span class="token punctuation">.</span>config<span class="token punctuation">.</span>menus <span class="token operator">=</span> editor<span class="token punctuation">.</span>config<span class="token punctuation">.</span>menus<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>menuKey<span class="token punctuation">)</span>

<span class="token comment">// 注册完菜单，再创建编辑器，顺序很重要！！</span>
editor<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> editor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token string">'#div2'</span><span class="token punctuation">)</span>
editor2<span class="token punctuation">.</span>menus<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>menuKey2<span class="token punctuation">,</span> AlertMenu<span class="token punctuation">)</span>
editor2<span class="token punctuation">.</span>config<span class="token punctuation">.</span>menus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>menuKey2<span class="token punctuation">)</span>
editor2<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2><span id="实际项目结合示例">实际项目结合示例</span></h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token constant">E</span> <span class="token keyword">from</span> <span class="token string">"wangeditor"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> formulaEditor <span class="token keyword">from</span> <span class="token string">"easy-formula-editor"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createPanelConf <span class="token keyword">from</span> <span class="token string">"./create-panel-conf"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> PanelMenu<span class="token punctuation">,</span> Panel <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token constant">E</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AlertMenu</span> <span class="token keyword">extends</span> <span class="token class-name">PanelMenu</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">editor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// data-title属性表示当鼠标悬停在该按钮上时提示该按钮的功能简述</span>
    <span class="token keyword">const</span> $elem <span class="token operator">=</span> <span class="token constant">E</span><span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class="w-e-menu" data-title="数学公式">
        &lt;span>公式&lt;/span>
      &lt;/div></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>$elem<span class="token punctuation">,</span> editor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/**
   * 菜单点击事件
   */</span>
  <span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> formula <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formulaEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> conf <span class="token operator">=</span> <span class="token function">createPanelConf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>editor<span class="token punctuation">,</span> formula<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> panel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Panel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    formula<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"#edit-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">tryChangeActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> menuKey <span class="token operator">=</span> <span class="token string">"alertMenuKey"</span><span class="token punctuation">;</span>

<span class="token comment">// 注册菜单</span>
<span class="token constant">E</span><span class="token punctuation">.</span><span class="token function">registerMenu</span><span class="token punctuation">(</span>menuKey<span class="token punctuation">,</span> AlertMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">E</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F;create-panel-conf.ts
export default function (wangEditor, formulaEditor) &#123;
    const btnOkId &#x3D; &#39;btn-ok&#39;
  
    &#x2F;**
     * 插入公式
     *&#x2F;
    function insertFomule() &#123;
      const formula &#x3D; formulaEditor.latex.text()
      &#x2F;&#x2F; 注意插入wangEditor时左右两边的空格不能去掉，不然会导致无法获取焦点
      wangEditor.txt.append(&#39;&lt;p&gt;&#39;+formula+&#39;&lt;&#x2F;p&gt;&#39;)
      return true
    &#125;
  
    &#x2F;&#x2F; tabs配置
    const tabsConf &#x3D; [
      &#123;
        &#x2F;&#x2F; tab 的标题
        title: &quot;插入数学公式&quot;,
        &#x2F;&#x2F; 模板
        tpl: &#96;&lt;div&gt;
                &lt;div id&#x3D;&quot;edit-content&quot;&gt;&lt;&#x2F;div&gt;
                &lt;div class&#x3D;&quot;w-e-button-container&quot;&gt;
                  &lt;button type&#x3D;&quot;button&quot; id&#x3D;&quot;$&#123;btnOkId&#125;&quot; class&#x3D;&quot;right&quot;&gt;插入&lt;&#x2F;button&gt;
                &lt;&#x2F;div&gt;
              &lt;&#x2F;div&gt;&#96;,
        &#x2F;&#x2F; 事件绑定
        events: [
          &#x2F;&#x2F; 插入视频
          &#123;
            selector: &#39;#&#39; + btnOkId,
            type: &#39;click&#39;,
            fn: insertFomule,
            bindEnter: true,
          &#125;,
        ],
      &#125;, &#x2F;&#x2F; tab end
    ]
  
    return &#123;
        width: 660,
        height: 0,
        &#x2F;&#x2F; panel 中可包含多个 tab
        tabs: tabsConf, &#x2F;&#x2F; tabs end
      &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用上面的代码，就可以在富文本编辑器中添加一个公式编辑器的菜单了：</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;
  &lt;div class&#x3D;&quot;formula-container&quot;&gt;
    &lt;v-card elevation&#x3D;&quot;0&quot; class&#x3D;&quot;formula-card&quot; title&#x3D;&quot;输出区域&quot; subtitle&#x3D;&quot;Output&quot;&gt;
      &lt;div id&#x3D;&quot;formula&quot; class&#x3D;&quot;formula-content&quot;&gt;
        &#123;&#123; renderedFormula ? &#96;$$&#123;renderedFormula&#125;$&#96; : &#39;&#39; &#125;&#125;
      &lt;&#x2F;div&gt;
    &lt;&#x2F;v-card&gt;
    &lt;div class&#x3D;&quot;editor-area&quot;&gt;
      &lt;div id&#x3D;&quot;wang-editor&quot; class&#x3D;&quot;editor&quot;&gt;&lt;&#x2F;div&gt;
    &lt;&#x2F;div&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;


&lt;script setup&gt;
import E from &quot;..&#x2F;utils&#x2F;formula-menu-conf&quot;;
import &#123; ref, onMounted, nextTick, defineProps, watchEffect &#125; from &quot;vue&quot;;

&#x2F;&#x2F; 定义props
const props &#x3D; defineProps(&#123;
  initMessage: &#123;
    type: String,
    default: &quot;&quot;,
  &#125;
&#125;);

watchEffect(() &#x3D;&gt; &#123;
  props.initMessage;
&#125;);

const editor &#x3D; ref(null);
const renderedFormula &#x3D; ref(&quot;&quot;);

function convert() &#123;
  MathJax.texReset();
  MathJax.typesetClear();
  MathJax.typesetPromise();
&#125;

function updateFormula() &#123;
  renderedFormula.value &#x3D; editor.value.txt.text();
  nextTick(convert);
&#125;

onMounted(() &#x3D;&gt; &#123;
  editor.value &#x3D; new E(&quot;#wang-editor&quot;);
  editor.value.config.height &#x3D; 360;
  editor.value.config.menus &#x3D; [&#39;head&#39;, &#39;bold&#39;, &#39;underline&#39;, &#39;strikeThrough&#39;,&#39;emoticon&#39;, &#39;undo&#39;, &#39;redo&#39;];
  editor.value.config.onchange &#x3D; updateFormula;
  editor.value.config.onchangeTimeout &#x3D; 500;
  editor.value.create();
  editor.value.txt.html(props.initMessage);
&#125;);

&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，我们的公式编辑器和富文本编辑器完美结合了，效果如下：</p>
<p><img src="/img/mathjax/mathjax-2.png" alt="MathJax"></p>
<p>贴一个wangeditor的官方文档：<a target="_blank" rel="noopener" href="https://www.wangeditor.com/v4">www.wangeditor.com/v4</a></p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/01/23/react-3/" itemprop="url">React入门-第三篇</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-01-23T04:36:30.000Z" itemprop="datePublished">January 23, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/React/">React</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="前言">前言</span></h2><p>本篇主要对React的状态进行一个介绍。</p>
<p><strong>声明式 UI 与命令式 UI 的比较</strong></p>
<p>当你设计 UI 交互时，可能会去思考 UI 如何根据用户的操作而响应变化。想象一个允许用户提交一个答案的表单：</p>
<ul>
<li><p>当你向表单输入数据时，“提交”按钮会随之变成可用状态</p>
</li>
<li><p>当你点击“提交”后，表单和提交按钮都会随之变成不可用状态，并且会加载动画会随之出现</p>
</li>
<li><p>如果网络请求成功，表单会随之隐藏，同时“提交成功”的信息会随之出现</p>
</li>
<li><p>如果网络请求失败，错误信息会随之出现，同时表单又变为可用状态</p>
</li>
</ul>
<p><code>在 命令式编程 中，以上的过程直接告诉你如何去实现交互。你必须去根据要发生的事情写一些明确的命令去操作 UI。</code></p>
<p>而在Vuejs渐进式框架和React库里面都是采用的声明式编程。</p>
<h2><span id="声明式地考虑-ui">声明式地考虑 UI</span></h2><p>你已经从上面的例子看到如何去实现一个表单了，为了更好地理解如何在 React 中思考，一般情况下要用 React 重新实现这个 UI就要经过这几个一般步骤：</p>
<ol>
<li><p>定位你的组件中不同的视图状态</p>
</li>
<li><p>确定是什么触发了这些 state 的改变</p>
</li>
<li><p>表示内存中的 state（需要使用 useState）</p>
</li>
<li><p>删除任何不必要的 state 变量</p>
</li>
<li><p>连接事件处理函数去设置 state</p>
</li>
</ol>
<h2><span id="react的状态管理">React的状态管理</span></h2><p>在React中，状态管理是一个非常重要的概念，React的状态管理是通过<code>state</code>来实现的。</p>
<h3><span id="state">state</span></h3><p><code>state</code>是React组件中的一个内置对象，用于存储组件内部的状态。<code>state</code>是一个普通的JavaScript对象，我们可以通过<code>this.state</code>来访问它。</p>
<p><strong>React 会为 UI 中的组件结构构建 渲染树。</strong></p>
<p>当向一个组件添加状态时，那么可能会认为状态“存在”在组件内。但实际上，状态是由 React 保存的。<strong>React 通过组件在渲染树中的位置将它保存的每个状态与正确的组件关联起来。</strong></p>
<p>这边与Vuejs的区别是，Vue的响应式系统是与组件进行隔离开来的，而React的状态是与组件进行绑定的。</p>
<p><em>我们将state嵌入进React的组件里面，作为组件vnode的一部分信息，当React的state更新时，也意味着组件的信息更新，会触发组件的重新渲染。</em></p>
<p>如果理解了这一点，那么我们就可以很轻易的理解React的响应式是怎么工作的了，React的状态是与组件绑定的，当状态更新时，组件也会更新，这也是React的响应式系统。</p>
<p>我们来具体给一个例子：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>counter<span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#123;</span>counter<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>score<span class="token punctuation">,</span> setScore<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>hover<span class="token punctuation">,</span> setHover<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> className <span class="token operator">=</span> <span class="token string">'counter'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hover<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    className <span class="token operator">+=</span> <span class="token string">' hover'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div
      className<span class="token operator">=</span><span class="token punctuation">&#123;</span>className<span class="token punctuation">&#125;</span>
      onPointerEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setHover</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      onPointerLeave<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setHover</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>score<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setScore</span><span class="token punctuation">(</span>score <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        加一
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是它们的树形结构的样子：</p>
<p><img src="/img/react/react-4.webp" alt="vue-react"></p>
<p>这是两个独立的 counter，因为它们在树中被渲染在了各自的位置。 一般情况下你不用去考虑这些位置来使用 React，但知道它们是如何工作会很有用。</p>
<p>而他们有各自的状态，因为每个组件实例都有自己的 state。 你可以在一个组件中使用多个 state 变量。当我更新了state之后，会触发组件的重新渲染，这边我们可以看到，两个counter的状态是独立的，互不影响。</p>
<p><strong>相同位置的相同组件会使得 state 被保留下来</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isFancy<span class="token punctuation">,</span> setIsFancy<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>isFancy <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Counter isFancy<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> 
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Counter isFancy<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token boolean">false</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> 
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>label<span class="token operator">></span>
        <span class="token operator">&lt;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>isFancy<span class="token punctuation">&#125;</span>
          onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">setIsFancy</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>checked<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
        <span class="token operator">/</span><span class="token operator">></span>
        使用好看的样式
      <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isFancy <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>score<span class="token punctuation">,</span> setScore<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>hover<span class="token punctuation">,</span> setHover<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> className <span class="token operator">=</span> <span class="token string">'counter'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hover<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    className <span class="token operator">+=</span> <span class="token string">' hover'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isFancy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    className <span class="token operator">+=</span> <span class="token string">' fancy'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div
      className<span class="token operator">=</span><span class="token punctuation">&#123;</span>className<span class="token punctuation">&#125;</span>
      onPointerEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setHover</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      onPointerLeave<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setHover</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>score<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setScore</span><span class="token punctuation">(</span>score <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        加一
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/img/react/react-7.webp" alt="vue-react"></p>
<p>那么<strong>相同位置的不同组件会使 state 重置</strong>，这一点应该大家也能够知道为什么了。</p>
<p>再举一个例子：将一个<code>&lt;Counter&gt; </code>替换为一个 <code>&lt;p&gt;</code></p>
<p><img src="/img/react/react-5.webp" alt="vue-react"></p>
<p>当 Counter 变为 p 时，Counter 会被移除，同时 p 被添加。</p>
<p><img src="/img/react/react-6.webp" alt="vue-react"></p>
<p>当切换回来时，p 会被删除，而 Counter 会被添加</p>
<p>参考的React文档在这里：<a target="_blank" rel="noopener" href="https://zh-hans.react.dev/learn/preserving-and-resetting-state">状态与渲染树中的位置相关</a></p>
<h2><span id="提取状态逻辑到-reducer-中">提取状态逻辑到 reducer 中</span></h2><p><strong>对于那些需要更新多个状态的组件来说，过于分散的事件处理程序可能会令人不知所措。</strong>对于这种情况，你可以在组件外部将所有状态更新逻辑合并到一个称为 <code>“reducer”</code> 的函数中。这样，事件处理程序就会变得简洁，因为它们只需要指定用户的 <code>“actions”</code>。在文件的底部，<code>reducer</code> 函数指定状态应该如何更新以响应每个 <code>action</code>！</p>
<p><strong>useReducer 是 React 中的一个 Hook，用于管理组件的状态逻辑。</strong><code>它提供了一种更复杂状态逻辑的组织方式，适用于那些包含多个子值或需要根据先前的状态来更新的状态。</code> useReducer 的使用方式类似于 <code>Redux</code> 中的 <code>reducer</code> 概念。</p>
<p>下面是 <code>useReducer</code> 的基本用法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// reducer函数，接受当前state和action，返回新的state</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 使用useReducer，传入reducer和初始state</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'INCREMENT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'DECREMENT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Decrement<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>主要的步骤包括：</p>
<ol>
<li><p>定义 <code>reducer</code> 函数： 这个函数接收当前状态 <code>state</code> 和一个描述动作的 <code>action</code>，然后根据 <code>action</code> 的类型执行相应的逻辑，并返回新的状态。</p>
</li>
<li><p>初始化状态： 通过调用 <code>useReducer(reducer, initialState)</code> 来创建状态和 <code>dispatch</code> 函数。</p>
</li>
<li><p>在组件中使用状态和 <code>dispatch</code>： 通过 <code>state</code> 访问当前状态值，通过 <code>dispatch</code> 触发 <code>reducer</code> 执行。</p>
</li>
</ol>
<h2><span id="使用-context-进行深层数据传递">使用 Context 进行深层数据传递</span></h2><p><strong>通常，你会通过 props 将信息从父组件传递给子组件。</strong> 但是，如果要在组件树中深入传递一些 prop，或者树里的许多组件需要使用相同的 prop，那么传递 prop 可能会变得很麻烦。Context 允许父组件将一些信息提供给它下层的任何组件，不管该组件多深层也无需通过 props 逐层透传。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> createContext<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个Context</span>
<span class="token keyword">const</span> MyContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个包含Provider和Consumer的组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Hello from Context'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>MyContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> setData <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>MyContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 useContext 获取Context中的值</span>
<span class="token keyword">const</span> <span class="token function-variable function">ChildComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> setData <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">'Updated Context'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Update Context<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 在应用中使用Provider包裹需要共享数据的组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>MyProvider<span class="token operator">></span>
      <span class="token operator">&lt;</span>ChildComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>MyProvider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2><span id="使用-reducer-和-context-进行状态扩展">使用 Reducer 和 Context 进行状态扩展</span></h2><p>Reducer 帮助你合并组件的状态更新逻辑同时Context 帮助你将信息深入传递给其他组件。</p>
<p>你可以将 reducers 和 context 组合在一起使用，以管理复杂应用的状态。</p>
<p>基于这种想法，使用 reducer 来管理一个具有复杂状态的父组件。组件树中任何深度的其他组件都可以通过 context 读取其状态。还可以 dispatch 一些 action 来更新状态。</p>
<p><code>合理的使用 Reducer 和 Context 可以帮助你更好的管理状态，同时也可以让你的代码更加简洁。</code></p>
<p>相比于Vuejs基于Proxy的响应式系统，使用代理的方式，以及provide和inject的方式，Vuejs的状态管理是在一个单独的WeekMap里面进行管理的，当变量的状态进行改变，可以激活effect副作用函数，并进行值的更新。而React的状态管理是与组件绑定的，当状态更新时，组件也会更新，但是当我们要进行一个全局状态的管理时，就得进行在父组件里面定义。</p>
<p>能基于具体的情况进行React状态的定义，才能更好的进行状态的管理。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/01/20/react-2/" itemprop="url">React入门-第二篇</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-01-20T09:45:56.000Z" itemprop="datePublished">January 20, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/React/">React</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="前言">前言</span></h2><p>这一篇主要来聊一聊React的JSX如何被编译成VNode的。</p>
<h2><span id="vue的render函数">Vue的render函数</span></h2><p><strong>在此之前，我们都知道，Vue是使用Vue模板方法的方式进行组件的声明。</strong>我们先来回顾一下Vue是怎么处理的。</p>
<p>Vue模板经过Vue的编译器编译成render函数，最后render函数返回VNode，然后再通过patch函数将VNode渲染成真实DOM。</p>
<p>具体的renderer细节在以前的章节里面有提到过，这边就不再赘述了。</p>
<h2><span id="react的jsx">React的JSX</span></h2><p><code>react</code>通过将组件编写的JSX映射到屏幕，以及组件中的状态发生了变化之后 <code>React</code>会将这些「变化」更新到屏幕上</p>
<p>JSX通过<code>babel</code>最终转化成<code>React.createElement</code>这种形式,至于babel是具体怎么将JSX转化成<code>React.createElement</code>的，我们可以通过babel的在线编译器来查看。</p>
<pre class="line-numbers language-Html" data-language="Html"><code class="language-Html">&lt;div&gt;
  &lt; img src&#x3D;&quot;avatar.png&quot; className&#x3D;&quot;profile&quot; &#x2F;&gt;
  &lt;Hello &#x2F;&gt;
&lt;&#x2F;div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>会被bebel转化成如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
  <span class="token string">"div"</span><span class="token punctuation">,</span>
  <span class="token keyword">null</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"avatar.png"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">"profile"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>Hello<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong><code>Babel</code>提供一个<code>REPL</code>在线编译器，可以在线将ES6代码转为ES5代码。转换后的代码，可以直接作为ES5代码插入网页运行</strong>,这边贴一个链接：<a target="_blank" rel="noopener" href="https://babeljs.io/">https://babeljs.io/</a></p>
<p><img src="/img/react/react-1.png" alt="vue-react"></p>
<p>在转化过程中，babel在编译时会判断 JSX 中组件的首字母：</p>
<p>当首字母为小写时，其被认定为原生 DOM 标签，<code>createElement</code> 的第一个变量被编译为字符串</p>
<p>当首字母为大写时，其被认定为自定义组件，<code>createElement</code> 的第一个变量被编译为对象</p>
<p>最终都会通过<code>RenderDOM.render(...)</code>方法进行挂载，如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2><span id="react的jsx转换具体是怎么做的呢">React的JSX转换具体是怎么做的呢</span></h2><p>在react中，节点大致可以分成四个类别：</p>
<ul>
<li>原生标签节点</li>
<li>文本节点</li>
<li>函数组件</li>
<li>类组件</li>
</ul>
<p>如下所示：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">ClassComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">"pink"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>ClassComponent<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p <span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border"</span><span class="token operator">></span>
      FunctionComponent
      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p <span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"border"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>xx<span class="token operator">&lt;</span><span class="token operator">/</span>p <span class="token operator">></span>
    <span class="token operator">&lt;</span> a href<span class="token operator">=</span><span class="token string">" "</span><span class="token operator">></span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span> a<span class="token operator">></span>
    <span class="token operator">&lt;</span>FunctionComponent name<span class="token operator">=</span><span class="token string">"函数组件"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>ClassComponent name<span class="token operator">=</span><span class="token string">"类组件"</span> color<span class="token operator">=</span><span class="token string">"red"</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>这些类别最终都会被转化成React.createElement这种形式</strong></p>
<p><img src="/img/react/react-2.png" alt="vue-react"></p>
<p>React.createElement其被调用时会传⼊标签类型type，标签属性props及若干子元素children，作用是生成一个虚拟Dom对象，如下所示：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">delete</span> config<span class="token punctuation">.</span>__self<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> config<span class="token punctuation">.</span>__source<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ! 源码中做了详细处理，⽐如过滤掉key、ref等</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>config<span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=></span>
   <span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">?</span> child <span class="token operator">:</span> <span class="token function">createTextNode</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        type<span class="token punctuation">,</span>
        props
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">TEXT</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">nodeValue</span><span class="token operator">:</span> text
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    createElement
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>createElement会根据传入的节点信息进行一个判断：</p>
<ul>
<li>如果是原生标签节点， type 是字符串，如div、span</li>
<li>如果是文本节点， type就没有，这里是 TEXT</li>
<li>如果是函数组件，type 是函数名</li>
<li>如果是类组件，type 是类名</li>
<li>虚拟DOM会通过ReactDOM.render进行渲染成真实DOM，使用方法如下：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> container<span class="token punctuation">[</span><span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>当首次调用时，容器节点里的所有 DOM 元素都会被替换，后续的调用则会使用 React 的 diff算法进行高效的更新</p>
<p>如果提供了可选的回调函数callback，该回调将在组件被渲染或更新之后被执行<br>render大致实现方法如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"vnode"</span><span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 虚拟DOM对象</span>
    <span class="token comment">// vnode _> node</span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">createNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 创建真实DOM节点</span>
<span class="token keyword">function</span> <span class="token function">createNode</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> parentNode</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> props<span class="token punctuation">&#125;</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token constant">TEXT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        node <span class="token operator">=</span> type<span class="token punctuation">.</span>isReactComponent
            <span class="token operator">?</span> <span class="token function">updateClassComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> parentNode<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> parentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 遍历下子vnode，然后把子vnode->真实DOM节点，再插入父node中</span>
<span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">children<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">updateNode</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> nextVal</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>nextVal<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">k</span> <span class="token operator">=></span> k <span class="token operator">!==</span> <span class="token string">"children"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">k</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"on"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> eventName <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> nextVal<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            node<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> nextVal<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 返回真实dom节点</span>
<span class="token comment">// 执行函数</span>
<span class="token keyword">function</span> <span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> parentNode</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> props<span class="token punctuation">&#125;</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
    <span class="token keyword">let</span> vvnode <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">createNode</span><span class="token punctuation">(</span>vvnode<span class="token punctuation">,</span> parentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 返回真实dom节点</span>
<span class="token comment">// 先实例化，再执行render函数</span>
<span class="token keyword">function</span> <span class="token function">updateClassComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> parentNode</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> props<span class="token punctuation">&#125;</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span>
    <span class="token keyword">let</span> cmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">type</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vvnode <span class="token operator">=</span> cmp<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">createNode</span><span class="token punctuation">(</span>vvnode<span class="token punctuation">,</span> parentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    render
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在react源码中，虚拟Dom转化成真实Dom整体流程如下图所示：</p>
<p><img src="/img/react/react-3.png" alt="vue-react"></p>
<p>其渲染流程如下所示：</p>
<ul>
<li><p>使用<code>React.createElement</code>或<code>JSX</code>编写<code>React</code>组件，实际上所有的 <code>JSX</code> 代码最后都会转换成<code>React.createElement(...) </code>，<code>Babel</code>帮助我们完成了这个转换的过程。</p>
</li>
<li><p><code>createElement</code>函数对key和ref等特殊的props进行处理，并获取defaultProps对默认props进行赋值，并且对传入的孩子节点进行处理，最终构造成一个虚拟DOM对象</p>
</li>
<li><p><code>ReactDOM.render</code>将生成好的虚拟DOM渲染到指定容器上，其中采用了批处理、事务等机制并且对特定浏览器进行了性能优化，最终转换为真实DOM</p>
</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2024/01/20/react-1/" itemprop="url">React入门-第一篇</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2024-01-20T09:10:25.000Z" itemprop="datePublished">January 20, 2024</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/React/">React</a>
        </span>
        
        
        
    </div>
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2><span id="前言">前言</span></h2><p>最近面了得物春季青训营，项目要求掌握React。之前写过一段时间Next.js，对jsx的理解还算是有些片面，作为Vuejs转React的一个开发者，打算先将Vuejs和React的功能特性做一个对比，然后再根据项目入手React。</p>
<h2><span id="vuejs和react的相同点">Vuejs和React的相同点</span></h2><p><img src="/img/react/vue-react.jpg" alt="vue-react"></p>
<p>Vue和React相同点非常多：</p>
<ul>
<li>都使用Virtural DOM</li>
<li>都使用组件化思想，流程基本一致</li>
<li>都是响应式，推崇单向数据流（Vue的v-model指令允许在表单元素上进行双向数据绑定。）</li>
<li>都有成熟的社区，都支持服务端渲染</li>
</ul>
<p><strong>Vue和React实现原理和流程基本一致，都是使用Virtual DOM + Diff算法。</strong></p>
<p>不管是Vue的<code>template模板 + options api写法</code>（即使用SFC体系），还是React的<code>Class或者Function</code>（js 的class写法也是function函数的一种）的jsx写法，底层最终都是为了生成render函数。</p>
<p><strong>render函数执行返回VNode（虚拟DOM树）。</strong> 当每一次UI更新时，总会根据render重新生成最新的VNode，然后跟以前缓存起来老的VNode进行比对，再使用Diff算法（框架核心）去真正更新真实DOM（虚拟DOM是JS对象结构，同样在JS引擎中，而真实DOM在浏览器渲染引擎中，所以操作虚拟DOM比操作真实DOM开销要小的多）。</p>
<p>Vue和React通用流程：</p>
<p><code>vue template/react jsx -&gt; render函数 -&gt; 生成VNode -&gt; 当有变化时，新老VNode diff -&gt; diff算法对比，并真正去更新真实DOM。</code></p>
<p>核心还是Virtual DOM，VNode的好处不用多说：</p>
<ul>
<li><p>减少直接操作DOM。框架给我们提供了屏蔽底层dom书写的方式，减少频繁的整更新dom，同时也使得数据驱动视图</p>
</li>
<li><p>为函数式UI编程提供可能（React核心思想）</p>
</li>
<li><p>可以跨平台，渲染到DOM（web）之外的平台。比如ReactNative，Weex</p>
</li>
</ul>
<p><img src="/img/react/react-vue.webp" alt="vue-react"></p>
<p>Vue说自己是框架，是因为官方提供了从声明式渲染到构建工具一整套东西。</p>
<p>React说自己是库，是因为官方只提供了React.js这个核心库，路由、状态管理这些都是社区第三方提供了，最终整合成了一套方案。</p>
<h2><span id="vue和react的区别">Vue和React的区别</span></h2><h3><span id="组件实现不同">组件实现不同</span></h3><h4><span id="vuejs实现">Vuejs实现</span></h4><p><strong>Vue源码实现是把options挂载到Vue核心类上，然后再new Vue({options})拿到实例（vue组件的script导出的是一个挂满options的纯对象而已）。</strong></p>
<p>所以options api中的this指向内部Vue实例，对用户是不透明的，所以需要文档去说明this.$slot、this.$xxx这些api。另外Vue插件都是基于Vue原型类基础之上建立的，这也是Vue插件使用Vue.install的原因，因为要确保第三方库的Vue和当前应用的Vue对象是同一个。</p>
<h4><span id="react实现">React实现</span></h4><p><strong>React内部实现比较简单，直接定义render函数以生成VNode</strong> ，而React内部使用了四大组件类包装VNode，不同类型的VNode使用相应的组件类处理，职责划分清晰明了（后面的Diff算法也非常清晰）。React类组件都是继承自React.Component类，其this指向用户自定义的类，对用户来说是透明的。</p>
<h3><span id="响应式原理不同">响应式原理不同</span></h3><h4><span id="vuejs实现">Vuejs实现</span></h4><ul>
<li>Vue依赖收集，自动优化，数据可变。</li>
<li>Vue递归监听data的所有属性,直接修改。</li>
<li>当数据改变时，自动找到引用组件重新渲染。</li>
</ul>
<h4><span id="react实现">React实现</span></h4><ul>
<li>React基于状态机，手动优化，数据不可变，需要setState驱动新的State替换老的State。</li>
<li>当数据改变时，以组件为根目录，默认全部重新渲染</li>
</ul>
<h3><span id="diff算法不同">diff算法不同</span></h3><p>Vue基于snabbdom库，它有较好的速度以及模块机制。Vue Diff使用双向链表，边对比，边更新DOM。</p>
<p>React主要使用diff队列保存需要更新哪些DOM，得到patch树，再统一操作批量更新DOM。</p>
<h3><span id="事件机制不同">事件机制不同</span></h3><h4><span id="vuejs实现">Vuejs实现</span></h4><ul>
<li>Vue原生事件使用标准Web事件</li>
<li>Vue组件自定义事件机制，是父子组件通信基础</li>
<li>Vue合理利用了snabbdom库的模块插件</li>
</ul>
<h4><span id="react实现">React实现</span></h4><ul>
<li>React原生事件被包装，所有事件都冒泡到顶层document监听，然后在这里合成事件下发。基于这套，可以跨端使用事件机制，而不是和Web DOM强绑定。</li>
<li>React组件上无事件，父子组件通信使用props</li>
</ul>

    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous is-invisible is-hidden-mobile">
        <a href="/archives/0/">上一頁</a>
    </div>
    <div class="pagination-next">
        <a href="/archives/2/">下一頁</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link is-current" href="/">1</a></li>
        
        <li><a class="pagination-link" href="/archives/2/">2</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="/archives/5/">5</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Huangzl&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow" title="GitHub" target="_blank" rel="noopener" href="https://github.com/ikkkp">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
<div class="column is-narrow has-text-centered">
    <div class="dropdown is-up is-right is-hoverable" style="margin-top: -0.2em;">
        <div class="dropdown-trigger">
            <button class="button is-small" aria-haspopup="true">
                <span class="icon">
                    <i class="fas fa-globe"></i>
                </span>
                <span>中文</span>
                <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
            </button>
        </div>
        <div class="dropdown-menu has-text-left" role="menu" style="top:100%">
            <div class="dropdown-content">
            <!-- NOTE: 永遠回到首頁 -->
            
                <a href="/en/" class="dropdown-item">
                    English
                </a>
            
            </div>
        </div>
    </div>
</div>

        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    
    
    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js?v=3.js"></script>


    
</body>
</html>